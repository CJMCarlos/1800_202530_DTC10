<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Add Task | TimeMate</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Custom CSS + Fonts -->
    <script type="module" src="/src/app.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap"
      rel="stylesheet"
    />

    <!-- Components -->
    <script type="module" src="./src/components/site-navbar.js"></script>
    <script type="module" src="./src/components/site-footer.js"></script>
  </head>

  <body class="body-bg">
    <site-navbar></site-navbar>

    <div class="container py-5" style="max-width: 480px">
      <h3 class="text-center mb-4">Add New Task</h3>

      <form id="addEventForm" class="bg-light p-4 rounded shadow-sm">
        <div class="mb-3">
          <label for="eventName" class="form-label">Task Name</label>
          <input
            type="text"
            class="form-control"
            id="eventName"
            placeholder="e.g. Dinner with team"
            required
          />
        </div>

        <div class="mb-3">
          <label for="eventDescription" class="form-label">Description</label>
          <textarea
            class="form-control"
            id="eventDescription"
            rows="4"
            placeholder="Add details about your event (press Enter for new line)..."
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="eventDate" class="form-label">Task Date</label>
          <input type="date" class="form-control" id="eventDate" required />
        </div>

        <div class="mb-3">
          <label for="reminder" class="form-label">Reminder</label>
          <select class="form-select" id="reminder">
            <option value="none">No reminder</option>
            <option value="1">1 day before</option>
            <option value="3">3 days before</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary w-100">Add Task</button>
      </form>
    </div>

    <site-footer></site-footer>

    <script type="module">
      import { addTaskForCurrentUser } from "./src/tasksClient.js";

      document
        .getElementById("addEventForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          try {
            const taskData = {
              title: document.getElementById("eventName").value.trim(),
              details: document.getElementById("eventDescription").value.trim(),
              dueDate: document.getElementById("eventDate").value,
            };

            await addTaskForCurrentUser(taskData);
            window.location.href = "event.html"; // Redirect on success
          } catch (err) {
            console.error("Failed to add task:", err);
            alert("Failed to save task. Please make sure you are signed in.");
          }
        });
    </script>
  </body>
</html>
