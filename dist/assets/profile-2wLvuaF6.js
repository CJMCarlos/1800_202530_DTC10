import{o as E,d as g,b as w,g as v,e as l,a as P,p as I,r as B}from"./firebaseConfig-DPj6AoB7.js";import"./site-navbar-CbIaobPa.js";import{u as C}from"./authentication-C0790GnN.js";const d=document.getElementById("profilePictureDisplay"),h=document.getElementById("profilePictureInput"),L=document.getElementById("editProfilePicBtn");let c=!1;E(l,async o=>{if(o){try{const s=g(w,"users",o.uid),r=await v(s);r.exists()&&r.data().profilePicture?d.src=r.data().profilePicture:m()}catch(s){console.error("Error loading profile picture:",s),m()}const e=document.getElementById("usernameInput");e.placeholder=o.displayName||"Enter your username",e.value="";const t=document.getElementById("passwordInput");t.placeholder="Leave blank to keep current password",t.value=""}else window.location.href="login.html"});function m(){const e=encodeURIComponent(`
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="8" r="4" fill="#51624f"/>
      <path d="M6 20c0-4 4-6 6-6s6 2 6 6" fill="#51624f"/>
    </svg>
  `);d.src=`data:image/svg+xml;charset=utf-8,${e}`}L.addEventListener("click",()=>{h.click()});h.addEventListener("change",async o=>{const e=o.target.files[0];if(e){if(!e.type.startsWith("image/")){a("Please select a valid image file.");return}if(e.size>5*1024*1024){a("Image size must be less than 5MB.");return}try{const t=new FileReader;t.onload=async s=>{const r=s.target.result;d.src=r,c=!0;const u=l.currentUser;if(u)try{await P(g(w,"users",u.uid),{profilePicture:r},{merge:!0}),console.log("Profile picture saved!")}catch(y){console.error("Error saving profile picture:",y),a("Failed to save profile picture. Please try again."),c=!1}},t.readAsDataURL(e)}catch(t){console.error("Error processing image:",t),a("Failed to process image. Please try again.")}}});document.getElementById("profileForm");const x=document.getElementById("usernameInput"),f=document.getElementById("passwordInput"),D=document.getElementById("saveProfileBtn"),i=document.getElementById("usernameError"),n=document.getElementById("passwordError"),p=13;D.addEventListener("click",async o=>{o.preventDefault(),i.textContent="",i.classList.remove("show"),n.textContent="",n.classList.remove("show");const e=x.value.trim(),t=f.value.trim(),s=l.currentUser;if(!s){a("Please sign in to update your profile.");return}if(e&&e.length>p){i.textContent=`Username must be ${p} characters or fewer.`,i.classList.add("show");return}try{let r=!1;if(e&&e!==(s.displayName||"")&&(await C(e),r=!0),t){if(t.length<6){n.textContent="Password must be at least 6 characters.",n.classList.add("show");return}await I(s,t),f.value="",r=!0}r?a("Profile updated!"):c?(a("Profile updated!"),c=!1):a("No changes made")}catch(r){console.error("Error updating profile:",r),r.code==="auth/weak-password"?(n.textContent="Password too weak. Use at least 6 characters.",n.classList.add("show")):r.code==="auth/requires-recent-login"?a("Please log out and log in again to change password"):a("Profile updated!")}});const U=document.getElementById("logoutBtn");U.addEventListener("click",async()=>{try{await B(l),window.location.href="login.html"}catch(o){console.error("Error logging out:",o),a("Failed to log out. Please try again.")}});function a(o){let e=document.getElementById("notificationContainer");e||(e=document.createElement("div"),e.id="notificationContainer",document.body.appendChild(e));const t=document.createElement("div");t.className="notification",t.textContent=o,e.appendChild(t),setTimeout(()=>{t.classList.add("show")},50),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{t.remove()},300)},1700)}
