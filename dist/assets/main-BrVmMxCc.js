import{o as y,e as g,q as w,w as r,i as E,b as s,k as v,f as D,d as u,l as q}from"./firebaseConfig-DPj6AoB7.js";y(g,e=>{e?document.getElementById("name-goes-here").textContent=e.displayName||e.email.split("@")[0]:window.location.href="welcome.html"});const c=["Good Morning","Good Afternoon","Good Evening"],m=new Date().getHours();document.getElementById("greet-time").textContent=m<12?c[0]:m<18?c[1]:c[2];document.getElementById("today-date").textContent=new Date().toLocaleDateString("en-CA",{weekday:"long",month:"short",day:"numeric"});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("tasks-go-here"),d=document.getElementById("HomeEventPreview").content;y(g,async l=>{if(!l)return;const h=w(E(s,"tasks"),r("ownerId","==",l.uid),r("isCompleted","==",!1)),f=await v(h),n=[];f.forEach(o=>{const t=o.data();let a=null;if(t.dueDate?.toDate)a=t.dueDate.toDate();else if(typeof t.dueDate=="string"){const i=new Date(t.dueDate);isNaN(i)||(a=i)}n.push({id:o.id,...t,due:a})}),n.sort((o,t)=>o.due?t.due?o.due-t.due:-1:1);const p=n.slice(0,5);e.innerHTML="",p.forEach(o=>{const t=d.cloneNode(!0);t.querySelector(".evt-title").textContent=o.title,t.querySelector(".evt-desc").textContent=o.description||"",t.querySelector(".evt-date").textContent=o.due?o.due.toISOString().split("T")[0]:"",t.querySelector(".complete-toggle").dataset.id=o.id,t.querySelector(".edit-btn").dataset.edit=o.id,t.querySelector(".delete-btn").dataset.delete=o.id,e.appendChild(t)}),C()})});function C(){document.querySelectorAll(".complete-toggle").forEach(e=>{e.addEventListener("change",async()=>{const d=e.closest(".evt-card");d.classList.add("fade-out"),setTimeout(async()=>{await D(u(s,"tasks",e.dataset.id),{isCompleted:!0,completedAt:Date.now()}),d.remove()},400)})}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",async()=>{const d=e.closest(".evt-card");d.classList.add("fade-out"),setTimeout(async()=>{await q(u(s,"tasks",e.dataset.delete)),d.remove()},400)})}),document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>{window.location.href=`add-event.html?id=${e.dataset.edit}`})})}
